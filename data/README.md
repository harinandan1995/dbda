# Data Generation from Vector files
This module contains code to convert vector files which are generated by the algorithm in [paper](http://art-programmer.github.io/floorplan-transformation/paper.pdf) into image masks.


[Raster-to-Vector: Revisiting Floorplan Transformation ](http://art-programmer.github.io/floorplan-transformation/paper.pdf)

It takes vector files as input and converts them into masks and/or segmentation images and can store in three different formats
1. tfrecords
2. h5py
3. png (image)

## Usage

### Installation

Refer to the [README](https://gitlab.lrz.de/ge25gog/building-design-assistant/blob/master/README.md) for package installation using virtual environments

### Vector files

First you need to extract the `datasets/vectors.zip`

### Config

All the parameters needed to generate the data is stored in `config/transform.yaml`
```
{
  'input_dir': 'path to vectors folder',
  'output_dir': 'path to output directory',
  'output_type': 'h5' ,
  'width': 128,
  'height': 128,
  'num_output_images': 100,
  'wall_thickness': 2,
  'window_thickness': 2,
  'door_thickness': 2,
  'corner_thickness': 2,
  'shuffle': 'True'
}

Parameter descriptions are provided in the config file

```
### Run

```
    python3.7 transform.py
```

### Extraction

Tfrecords contain only masks for the elements
Hfpy files contain both masks and segementation images
Png files contain only segmentation images

Below is the information needed to extract the data from tfrecord or h5py

| Element  |                         Key | # Channels |
| :------ | :------------------------- | :--------: |
| Walls    | wall_mask, wall_seg         |     1      |
| Doors    | door_mask, door_seg         |     1      |
| Windows  | window_mask, window_seg     |     1      |
| Rooms    | room_mask, room_seg         |    10      |
| Corners  | corner_mask, corner_seg     |    17      |
| Entrance | entrance_mask, entrance_seg |     1      |
| Shape    | shape_mask, shape_seg       |     1      |


In a tfrecord the below meta information is also stored

| Key      |                 Description     |
| :------ | :----------------------------- |
| wall_count    | Number of walls in the plan|
| door_count    | Number of doors in the plan|
| window_count  | Number of windows in the plan|
| room_types    | Binary array indicating what room types are available|

Each channel in the room mask corresponds to a room type.
```
{
    'living_room': 1, 'kitchen': 2, 'bedroom': 3,
    'bathroom': 4, 'restroom': 4, 'washing_room': 4,
    'office': 5, 'closet': 6, 'balcony': 7,
    'corridor': 8, 'dining_room': 9, 'laundry_room': 10,
    'PS': 10
}
```

Each channel in the corner mask corresponds to a corner type
```
* 0 - 3: I-Shape
* 4 - 7: L-Shape
* 8 - 11: T-Shape
* 12: X-Shape
* 13 - 17: Doors and Windows
```
## Samples

Below are few segmentation images generated by the program

![Wall Segmenation](https://gitlab.lrz.de/ge25gog/building-design-assistant/tree/master/datasets/128/png/06/d6/fe932a20fc0aa3f7415811dd1ce6/0004_wall.png)

![Room Segmenation](https://gitlab.lrz.de/ge25gog/building-design-assistant/blob/master/datasets/128/png/0c/87/5a3657229d60df03502f3223a095/0001_room.png)

![Corner Segmenation](https://gitlab.lrz.de/ge25gog/building-design-assistant/tree/master/datasets/128/png/06/d6/fe932a20fc0aa3f7415811dd1ce6/0004_corner.png)
